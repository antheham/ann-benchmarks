# TODO:pgvector

# 用ANN-benchmark测试pgvector_ivfflat

## 环境配置
原版ann-benchmark是依靠在宿主机上为每个查询算法建立一个docker容器来测试的，但是目前我们的服务器本身就是一个docker容器。为了避免docker套docker的麻烦，且我们只需要测试pgvector_ivf，在测试不同版本的pgvector_ivf时，我们不再建立新容器，而是编译不同版本的vector.so扩展，并将其替换到postgresql中，然后运行ann-benchmark进行测试

具体配置步骤如下：

1. 拉取仓库
运行 `git clone https://github.com/mindtravel/ann-benchmarks.git`
运行 `cd ann-benchmarks`

2. 创建并激活conda环境
运行 `conda create -n ann-benchmarks python==3.10.6`
运行 `conda activate ann-benchmarks`

3. 安装python依赖
运行 `pip install -r requirements.txt`

4. 运行`./env/pgvector_ivf.sh`安装pgvector_ivf算法环境（脚本参考`ann_benchmarks/algorithms/pgvector_ivfflat`）



## 运行测试
测试脚本在目录`tests_scripts`中，各个测试的内容如下：
- `pgvector_flat_origin.sh`：测试pgvector_ivfflat.sh的单线程版本
- `pgvector_flat_multi.sh`：测试pgvector_ivfflat.sh的多线程版本
（之后只会保留一个pgvector_flat脚本测试多线程版本）
- `test_all_pgvector.sh`：运行所有测试并绘制图像到

直接运行`./test_all_pgvector.sh`即可